"use strict";exports.id=862,exports.ids=[862],exports.modules={1851:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.fetchPackage=void 0;const packages_1=__webpack_require__(7074);exports.fetchPackage=function fetchPackage(client,request){return client.logger.debug("Queued package: %s",request.package.name),client.fetchPackage(request).then((function(document){return client.logger.info("Fetched %s package from %s: %s@%s",document.providerName,document.response.source,request.package.name,request.package.version),packages_1.ResponseFactory.createSuccess(request,document)})).catch((function(error){return client.logger.error("%s caught an exception.\n Package: %j\n Error: %j",fetchPackage.name,request.package,error),Promise.reject(error)}))}},3081:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.fetchPackages=void 0;const fetchPackage_1=__webpack_require__(1851);exports.fetchPackages=async function(packagePath,client,clientData,dependencies){const{providerName}=client.config,results=[],promises=dependencies.map((function(dependency){const{name,version}=dependency.packageInfo,clientRequest={providerName,clientData,dependency,package:{name,version,path:packagePath},attempt:0};return(0,fetchPackage_1.fetchPackage)(client,clientRequest).then((function(responses){Array.isArray(responses)?results.push(...responses):results.push(responses)}))}));return Promise.all(promises).then((_=>results))}},920:function(__unused_webpack_module,exports,__webpack_require__){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);desc&&!("get"in desc?!m.__esModule:desc.writable||desc.configurable)||(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}),__exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)"default"===p||Object.prototype.hasOwnProperty.call(exports,p)||__createBinding(exports,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(__webpack_require__(1851),exports),__exportStar(__webpack_require__(3081),exports)},5141:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.AbstractProviderConfig=void 0;const providers_1=__webpack_require__(6424);exports.AbstractProviderConfig=class{constructor(providerName,config,caching,http){this.providerName=providerName,this.config=config,this.caching=caching,this.http=http,this.supports=[providers_1.ProviderSupport.Releases,providers_1.ProviderSupport.Prereleases]}providerName;config;supports;caching;http}},2502:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0})},8128:function(__unused_webpack_module,exports,__webpack_require__){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);desc&&!("get"in desc?!m.__esModule:desc.writable||desc.configurable)||(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}),__exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)"default"===p||Object.prototype.hasOwnProperty.call(exports,p)||__createBinding(exports,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(__webpack_require__(2502),exports),__exportStar(__webpack_require__(6903),exports),__exportStar(__webpack_require__(2041),exports)},6903:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.RequestLightClient=void 0;const clients_1=__webpack_require__(6502);class RequestLightClient extends clients_1.AbstractCachedRequest{logger;options;xhr;constructor(xhr,requestOptions,requestLogger){super(requestOptions.caching),this.logger=requestLogger,this.options=requestOptions,this.xhr=xhr}async request(method,baseUrl,query={},headers={}){const url=clients_1.UrlHelpers.createUrl(baseUrl,query),cacheKey=method+"_"+url;if(this.cache.cachingOpts.duration>0&&!1===this.cache.hasExpired(cacheKey)){const cachedResp=this.cache.get(cacheKey);return cachedResp.rejected?Promise.reject(cachedResp):Promise.resolve(cachedResp)}return this.xhr({url,type:method,headers,strictSSL:this.options.http.strictSSL}).then((response=>this.createCachedResponse(cacheKey,response.status,response.responseText,!1))).catch((response=>{const result=this.createCachedResponse(cacheKey,response.status,response.responseText,!0);return Promise.reject(result)}))}}exports.RequestLightClient=RequestLightClient},2041:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.createJsonClient=exports.createHttpClient=void 0;const clients_1=__webpack_require__(6502),requestLightClient_1=__webpack_require__(6903);function createHttpClient(options,logger){return new requestLightClient_1.RequestLightClient(__webpack_require__(5260).xhr,options,logger)}exports.createHttpClient=createHttpClient,exports.createJsonClient=function(options,logger){return new clients_1.JsonHttpClient(createHttpClient(options,logger))}},7862:function(__unused_webpack_module,exports,__webpack_require__){var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);desc&&!("get"in desc?!m.__esModule:desc.writable||desc.configurable)||(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]}),__exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)"default"===p||Object.prototype.hasOwnProperty.call(exports,p)||__createBinding(exports,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(__webpack_require__(4898),exports),__exportStar(__webpack_require__(3521),exports),__exportStar(__webpack_require__(1108),exports),__exportStar(__webpack_require__(9361),exports)},4297:(__unused_webpack_module,exports)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.DubContributions=void 0,function(DubContributions){DubContributions.Caching="dub.caching",DubContributions.Http="dub.http",DubContributions.DependencyProperties="dub.dependencyProperties",DubContributions.ApiUrl="dub.apiUrl",DubContributions.FilePatterns="dub.files"}(exports.DubContributions||(exports.DubContributions={}))},4898:function(__unused_webpack_module,exports,__webpack_require__){var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.readDubSelections=exports.parseSuggestions=exports.DubClient=void 0;const clients_1=__webpack_require__(6502),packages_1=__webpack_require__(7074),suggestions_1=__webpack_require__(804),node_fs_1=__importDefault(__webpack_require__(7561));function parseSuggestions(versionRange,releases,prereleases){const suggestions=(0,suggestions_1.createSuggestions)(versionRange,releases,prereleases),hasNoMatch=suggestions[0].name===suggestions_1.SuggestionStatus.NoMatch,isTildeVersion="~"===versionRange.charAt(0);if(hasNoMatch&&isTildeVersion&&releases.length>0){const latestRelease=releases[releases.length-1];latestRelease===versionRange?(suggestions[0]=suggestions_1.SuggestionFactory.createMatchesLatest(versionRange),suggestions.pop()):suggestions[1]=suggestions_1.SuggestionFactory.createLatest(latestRelease)}return suggestions}exports.DubClient=class{config;client;logger;constructor(config,client,logger){this.config=config,this.client=client,this.logger=logger}async fetchPackage(request){const semverSpec=packages_1.VersionHelpers.parseSemver(request.package.version),url=`${this.config.apiUrl}${encodeURIComponent(request.package.name)}/info`;return this.createRemotePackageDocument(url,request,semverSpec).catch((error=>{this.logger.debug("Caught exception from %s: %O",packages_1.PackageSourceTypes.Registry,error);const suggestion=suggestions_1.SuggestionFactory.createFromHttpStatus(error.status);return null!=suggestion?packages_1.DocumentFactory.create(packages_1.PackageSourceTypes.Registry,request,error,[suggestion]):Promise.reject(error)}))}async createRemotePackageDocument(url,request,semverSpec){return this.client.request(clients_1.HttpClientRequestMethods.get,url,{minimize:"true"},{}).then((function(httpResponse){const packageInfo=httpResponse.data,{providerName}=request,versionRange=semverSpec.rawVersion,requested=request.package,resolved={name:requested.name,version:versionRange},response={source:httpResponse.source,status:httpResponse.status},rawVersions=packages_1.VersionHelpers.extractVersionsFromMap(packageInfo.versions),{releases,prereleases}=packages_1.VersionHelpers.splitReleasesFromArray(rawVersions),suggestions=parseSuggestions(versionRange,releases,prereleases);return{providerName,source:packages_1.PackageSourceTypes.Registry,response,type:semverSpec.type,requested,resolved,suggestions}}))}},exports.parseSuggestions=parseSuggestions,exports.readDubSelections=async function(filePath){return new Promise((function(resolve,reject){!1!==node_fs_1.default.existsSync(filePath)?node_fs_1.default.readFile(filePath,"utf-8",((err,data)=>{if(err)return void reject(err);const selectionsJson=JSON.parse(data.toString());1==selectionsJson.fileVersion?resolve(selectionsJson):reject(new Error(`Unknown dub.selections.json file version ${selectionsJson.fileVersion}`))})):reject(null)}))}},3521:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.DubConfig=void 0;const clients_1=__webpack_require__(6502),abstractProviderConfig_1=__webpack_require__(5141),eDubContributions_1=__webpack_require__(4297);class DubConfig extends abstractProviderConfig_1.AbstractProviderConfig{constructor(config,caching,http){super("dub",config,caching,http)}get fileMatcher(){return{language:"json",scheme:"file",pattern:this.filePatterns}}get filePatterns(){return this.config.get(eDubContributions_1.DubContributions.FilePatterns)}get dependencyProperties(){return this.config.get(eDubContributions_1.DubContributions.DependencyProperties)}get apiUrl(){return clients_1.UrlHelpers.ensureEndSlash(this.config.get(eDubContributions_1.DubContributions.ApiUrl))}}exports.DubConfig=DubConfig},9361:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.configureContainer=void 0;const awilix_1=__webpack_require__(6675),clients_1=__webpack_require__(6502),http_1=__webpack_require__(8128),eDubContributions_1=__webpack_require__(4297),dubClient_1=__webpack_require__(4898),dubConfig_1=__webpack_require__(3521),dubSuggestionProvider_1=__webpack_require__(1108);exports.configureContainer=function(container){const services={dubCachingOpts:(0,awilix_1.asFunction)((appConfig=>new clients_1.CachingOptions(appConfig,eDubContributions_1.DubContributions.Caching,"caching"))).singleton(),dubHttpOpts:(0,awilix_1.asFunction)((appConfig=>new clients_1.HttpOptions(appConfig,eDubContributions_1.DubContributions.Http,"http"))).singleton(),dubConfig:(0,awilix_1.asFunction)(((appConfig,dubCachingOpts,dubHttpOpts)=>new dubConfig_1.DubConfig(appConfig,dubCachingOpts,dubHttpOpts))).singleton(),dubJsonClient:(0,awilix_1.asFunction)(((dubCachingOpts,dubHttpOpts,logger)=>(0,http_1.createJsonClient)({caching:dubCachingOpts,http:dubHttpOpts},logger.child({namespace:"dub request"})))).singleton(),dubClient:(0,awilix_1.asFunction)(((dubConfig,dubJsonClient,logger)=>new dubClient_1.DubClient(dubConfig,dubJsonClient,logger.child({namespace:"dub client"})))).singleton(),dubProvider:(0,awilix_1.asFunction)(((dubClient,logger)=>new dubSuggestionProvider_1.DubSuggestionProvider(dubClient,logger.child({namespace:"dub provider"})))).singleton()};return container.register(services),container.cradle.dubProvider}},1108:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.DubSuggestionProvider=void 0;const packages_1=__webpack_require__(920),packages_2=__webpack_require__(7074),suggestions_1=__webpack_require__(804);exports.DubSuggestionProvider=class{config;client;logger;suggestionReplaceFn;constructor(client,logger){this.client=client,this.config=client.config,this.logger=logger,this.suggestionReplaceFn=suggestions_1.defaultReplaceFn}parseDependencies(packageText){return(0,packages_2.extractPackageDependenciesFromJson)(packageText,this.config.dependencyProperties)}async fetchSuggestions(packagePath,packageDependencies){return(0,packages_1.fetchPackages)(packagePath,this.client,null,packageDependencies)}}}};
//# sourceMappingURL=862.extension.bundle.js.map